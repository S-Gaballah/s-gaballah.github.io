System.register(["@angular/core","./map-symbols.service","../shared/settings.service","../shared/firebase.service","esri/map","esri/layers/FeatureLayer","esri/SpatialReference","esri/geometry/Point","esri/graphic","esri/geometry/Extent","./visualization.service"],function(e,t){"use strict";var i,n,r,a,o,s,c,p,u,l,h,f,d=this&&this.__decorate||function(e,t,i,n){var r,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(o=(a<3?r(o):3<a?r(t,i,o):r(t,i))||o);return 3<a&&o&&Object.defineProperty(t,i,o),o},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};t&&t.id;return{setters:[function(e){i=e},function(e){n=e},function(e){r=e},function(e){a=e},function(e){o=e},function(e){s=e},function(e){c=e},function(e){p=e},function(e){u=e},function(e){l=e},function(e){h=e}],execute:function(){f=function(){function e(e,t,i,n){this.visualization=e,this._appSettingService=t,this._firebaseService=i,this._mapSymbolsService=n,this._androidFeeds=0,this._iphoneFeeds=0,this._androidVersions=[],this._iphoneVersions=[],this._isConnected=!1,i.initializeApp(),this._isTracking=!1,this._vehiclesLayer=new s.default(this.GetLayerDefination()),this._heatmapLayer=new s.default(this.GetLayerDefination(),{visible:!1})}return Object.defineProperty(e.prototype,"IsTracking",{get:function(){return this._isTracking},set:function(e){this._isTracking=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsConnected",{get:function(){return this._isConnected},set:function(e){this._isConnected=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TrackingPoint",{get:function(){return this._trackingPoint},set:function(e){!e&&this._trackingPoint&&this._trackingPoint.setSymbol(null),this._trackingPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HeatmapLayer",{get:function(){return this._heatmapLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"VehiclesLayer",{get:function(){return this._vehiclesLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LiveUsersCount",{get:function(){return this.VehiclesLayer?this.VehiclesLayer.graphics.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LiveAndroidUsersCount",{get:function(){return this.VehiclesLayer?this.VehiclesLayer.graphics.filter(function(e){return"android"==e.attributes.OSType}).length:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LiveIphoneUsersCount",{get:function(){return this.VehiclesLayer?this.VehiclesLayer.graphics.filter(function(e){return"android"!=e.attributes.OSType}).length:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AndroidFeeds",{get:function(){return this._androidFeeds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IphoneFeeds",{get:function(){return this._iphoneFeeds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AndroidVersions",{get:function(){return this._androidVersions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IphoneVersions",{get:function(){return this._iphoneVersions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Map",{get:function(){return this._map},enumerable:!0,configurable:!0}),e.prototype.CreateMap=function(){this._initialExtent=new l.default(this._appSettingService.MapExtent),this._map=new o.default("map",{basemap:"satellite",extent:this._initialExtent,showAttribution:!1,slider:!1,logo:!1,minScale:1155581.108577})},e.prototype.GoHome=function(){this.Map.setExtent(this._initialExtent)},e.prototype.DisplayBasicPoints=function(e,t,i){if(e&&t&&i){var n=this.CreatePoint(i.X,i.Y,4326),r=e.graphics.find(function(e){return e.attributes.ID==i.ID});if(r)(r=this.UpdateGraphic(r,n,i)).draw(),this.TrackingPoint&&this.TrackingPoint.attributes.ID==r.attributes.ID&&this._map.centerAndZoom(n,17);else{var a=this.CreateGraphic(n,i);e.add(a)}var o=t.graphics.find(function(e){return e.attributes.ID==i.ID});if(o)(o=this.UpdateGraphic(o,n,i)).draw();else{a=this.CreateGraphic(n,i);t.add(a)}}},e.prototype.removeVehiclesLayer=function(){this.VehiclesLayer.clear(),this.HeatmapLayer.clear(),this._androidFeeds=0,this._iphoneFeeds=0,this._iphoneVersions=[],this._androidVersions=[],clearInterval(this._intervalHandler)},e.prototype.addVehiclesLayer=function(){var a=this;this.VehiclesLayer||(this._vehiclesLayer=new s.default(this.GetLayerDefination())),this.HeatmapLayer||(this._heatmapLayer=new s.default(this.GetLayerDefination(),{visible:!1})),this._vehiclesLayer.on("mouse-over",function(e){var t=a.visualization.Color([255,235,175,1]),i=a.visualization.Color([0,255,197,.78]),n=a.visualization.SimpleLineSymbol(h.SimpleLineSymbolStyle.STYLE_SOLID,t),r=a.visualization.SimpleMarkerSymbol(null,n,i);(!a.TrackingPoint||a.TrackingPoint&&a.TrackingPoint.attributes.ID!=e.graphic.attributes.ID)&&e.graphic.setSymbol(r)}),this._vehiclesLayer.on("mouse-out",function(e){(!a.TrackingPoint||a.TrackingPoint&&a.TrackingPoint.attributes.ID!=e.graphic.attributes.ID)&&e.graphic.setSymbol(null)}),this.Map.addLayer(this._vehiclesLayer),this.Map.addLayer(this._heatmapLayer);var e=this.visualization.HeatmapRenderer();this._heatmapLayer.setRenderer(e),this.visualization.SetOSTypeSymbol(this.Map,[255,85,0],[164,198,57],[153,153,164],10,15,this._vehiclesLayer),this._intervalHandler=this._firebaseService.SimulateData(function(e){if(a._isConnected)if(e.val()){var i=e.val(),t=function(e){var t=i[e];0<t.Speed&&("android"==t.OSType?(a._androidFeeds+=1,null==a._androidVersions.find(function(e){return e.name==t.OSVersion})?a._androidVersions.push({name:t.OSVersion,value:1}):a._androidVersions.find(function(e){return e.name==t.OSVersion}).value+=1):(a._iphoneFeeds+=1,null==a._iphoneVersions.find(function(e){return e.name==t.OSVersion})?a._iphoneVersions.push({name:t.OSVersion,value:1}):a._iphoneVersions.find(function(e){return e.name==t.OSVersion}).value+=1),a.DisplayBasicPoints(a._vehiclesLayer,a._heatmapLayer,t))};for(var n in i)t(n)}else clearInterval(a._intervalHandler)})},e.prototype.AddGraphic=function(e,t){var i=this.CreatePoint(e.X,e.Y,4326),n=this.CreateGraphic(i,e);t.add(n)},e.prototype.CreateGraphic=function(e,t){return(new u.default).setGeometry(e).setAttributes(t)},e.prototype.UpdateGraphic=function(e,t,i){return e.setGeometry(t).setAttributes(i)},e.prototype.CreatePoint=function(e,t,i){return new p.default(e,t,new c.default({wkid:i}))},e.prototype.GetLayerDefination=function(){return{layerDefinition:{geometryType:"esriGeometryPoint",objectIdField:"ID",fields:[{name:"Accuracy",type:"esriFieldTypeString"},{name:"Heading",type:"esriFieldTypeDouble"},{name:"Y",type:"esriFieldTypeDouble"},{name:"X",type:"esriFieldTypeDouble"},{name:"ID",type:"esriFieldTypeString"},{name:"OSType",type:"esriFieldTypeString"},{name:"OSVersion",type:"esriFieldTypeString"},{name:"Speed",type:"esriFieldTypeDouble"},{name:"Heading",type:"esriFieldTypeString"}]},featureSet:{features:[],geometryType:"esriGeometryPoint"}}},e=d([i.Injectable({providedIn:"root"}),y("design:paramtypes",[h.VisualizationService,r.AppSettingService,a.FirebaseService,n.MapSymbolsService])],e)}(),e("MapService",f)}}});
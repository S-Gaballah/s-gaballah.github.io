System.register(["@angular/core","@angular/forms","../map/map.service","../map/toolbars.service","../map/visualization.service","../map/layers.service","../shared/config.service","rxjs"],function(t,e){"use strict";var i,r,o,a,s,n,l,c,p,u=this&&this.__decorate||function(t,e,i,o){var a,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var n=t.length-1;0<=n;n--)(a=t[n])&&(s=(r<3?a(s):3<r?a(e,i,s):a(e,i))||s);return 3<r&&s&&Object.defineProperty(e,i,s),s},d=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};e&&e.id;return{setters:[function(t){i=t},function(t){r=t},function(t){o=t},function(t){a=t},function(t){s=t},function(t){n=t},function(t){l=t},function(t){c=t}],execute:function(){p=function(){function t(t,e,i,o,a){this.mapService=t,this.visualization=e,this.layers=i,this.toolbars=o,this.config=a,this.isActive=!1,this.mapTextCTRL=new r.FormControl,this.textSizeCTRL=new r.FormControl,this.textAngelCTRL=new r.FormControl,this.textSizes=[],this.textAngles=[],this.isText=!1,this.drawingsGL=this.layers.GraphicsLayer("drawingsGL"),this.textGL=this.layers.GraphicsLayer("textGL"),this.textSizes=this.config.textSizes,this.textAngles=this.config.TextAngles,this.color=this.config.TextColor,this.symbolConfig={sfsStyle:s.SimpleFillSymbolStyle.STYLE_SOLID,slsStyle:s.SimpleLineSymbolStyle.STYLE_SOLID,smsStyle:s.SimpleMarkerSymbolStyle.STYLE_CIRCLE,sfsColor:[255,0,0,.25],slsColor:[255,0,0,1],smsColor:[255,0,0,1],outline:this.visualization.SimpleLineSymbol(),size:15,width:2}}return t.prototype.ngAfterViewInit=function(){this.onOpen()},t.prototype.ngOnChanges=function(){0==this.isActive&&this.drawToolbar&&this.DeactivateToolbar()},t.prototype.ActivateEditing=function(t){var e=a.EditTools.ROTATE+a.EditTools.EDIT_VERTICES+a.EditTools.MOVE;"esri.symbol.TextSymbol"===t.symbol.declaredClass&&(e|=a.EditTools.EDIT_TEXT);this.editToolbar.activate(e,t,{allowAddVertices:"true",allowDeleteVertices:"true",uniformScaling:"true"})},t.prototype.onOpen=function(){var r=this;this.drawToolbar=this.toolbars.Draw(this.mapService.Map),this.editToolbar=this.toolbars.Edit(this.mapService.Map);var t=c.default.Observable.fromEventPattern(function(t){return r.drawToolbar.on("draw-end",t)}),e=c.default.Observable.fromEventPattern(function(t){return r.mapService.Map.on("click",t)});c.default.Observable.fromEventPattern(function(t){return r.drawingsGL.on("click",t)}).subscribe(function(t){t.stopPropagation(),r.ActivateEditing(t.graphic)}),e.subscribe(function(t){r.editToolbar.deactivate()}),t.subscribe(function(t){r.visualization.CartographicLineSymbol(),r.visualization.SimpleMarkerSymbol(),r.visualization.PictureFillSymbol();var e=r.visualization.TextSymbol(r.mapText,r.textAngel,r.textSize,r.color);if(r.drawToolbar.deactivate(),r.mapService.Map.enableMapNavigation(),1==r.isText){e=r.visualization.TextSymbol(r.mapText,r.textAngel,r.textSize,r.color);var i=r.visualization.CreateGraphic(t.geometry,null,e);r.textGL.add(i),r.isText=!1}else{var o=r.visualization.DynamicSymbol(t.geometry.type,r.symbolConfig);i=r.visualization.CreateGraphic(t.geometry,null,o);r.drawingsGL.add(i),console.log(i)}var a=r.mapService.Map.graphicsLayerIds;a.includes(r.drawingsGL.id)||r.mapService.Map.addLayer(r.drawingsGL),a.includes(r.textGL.id)||r.mapService.Map.addLayer(r.textGL),r.activeTool="",r.Reset()})},t.prototype.setColor=function(t){console.log("value",t),this.color=t},t.prototype.Draw=function(t){this.activeTool=t,this.mapService.Map.disableMapNavigation(),this.drawToolbar.activate(t.toLowerCase())},t.prototype.ClearGraphics=function(){this.drawingsGL.clear()},t.prototype.DeactivateToolbar=function(){this.activeTool="",this.drawToolbar.deactivate(),this.editToolbar.deactivate(),this.ClearGraphics()},t.prototype.Reset=function(){this.mapTextCTRL.reset(),this.textAngelCTRL.reset(),this.textSizeCTRL.reset()},u([i.Input(),d("design:type",Object)],t.prototype,"isActive",void 0),t=u([i.Component({selector:"draw",templateUrl:"app/draw/draw.component.html",styleUrls:["app/draw/draw.css"]}),d("design:paramtypes",[o.MapService,s.VisualizationService,n.LayerService,a.ToolbarService,l.ConfigService])],t)}(),t("DrawComponent",p)}}});